<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="keywords" content="">

    <title>Neo4jMapper — The easiest way to map cypher values onto your entity models</title>

    <!-- Styles -->
    <link href="assets/css/page.min.css" rel="stylesheet">
    <link href="assets/css/prism.css" rel="stylesheet" />
    <link href="assets/css/barnardos.css" rel="stylesheet" />
    
    <!-- Favicons -->
    <link rel="apple-touch-icon" href="assets/img/apple-touch-icon.png">
    <link rel="icon" href="assets/img/favicon.png">

  </head>

  <body data-spy="scroll" data-target="#nav-scrollspy" data-offset="100" data-aos-easing="ease" data-aos-duration="1500"
    data-aos-delay="0" class="body-scrolled navbar-scrolled header-scrolled">

    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light navbar-stick-dark" data-navbar="sticky">
      <div class="container">

        <div class="navbar-left">
          <button class="navbar-toggler" type="button">&#9776;</button>
          <a class="navbar-brand" href="index.html">
              <img class="logo-dark" src="assets/img/neo4j-mapper-logo-dark.png" alt="logo">
              <img class="logo-light" src="assets/img/neo4j-mapper-logo-light.png" alt="logo">
          </a>
        </div>

        <section class="navbar-mobile">
          <span class="navbar-divider d-mobile-none"></span>

          <nav class="nav nav-navbar">
            <a class="nav-link" href="index.html">Home</a>
            <a class="nav-link active" href="guide.html">Usage Guide</a>
            <a class="nav-link" href="examples.html">Examples</a>
            <a class="nav-link" href="download.html">Download</a>
            <a class="nav-link" href="support.html">Support</a>
            <a class="nav-link badge badge-success btn-barnardos" href="#barnardos-donate">Donate</a>
          </nav>
        </section>

      </div>
    </nav><!-- /.navbar -->


    <!-- Header -->
    <header class="header text-white pt-8 pb-6" style="background-image: url('/assets/img/graph.svg'),linear-gradient(to right, #68bbf4, #6dcc9c);background-repeat: no-repeat;background-position: 50% 50%;background-size: auto;">
      <div class="container">
        <h1 class="display-4">Neo4j<span class="font-weight-bold">Mapper &lt;&gt;</span></h1>
        <p class="lead-2 mt-6">The easiest way to map cypher values onto your entity models.</p>
      </div>
    </header><!-- /.header -->


    <!-- Main Content -->
    <main class="main-content">


      <!--
      |‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒
      | Populate the page
      |‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒‒
      !-->
      <section class="section">
        <div class="container">
          <div class="row mb-8">
            <div class="col-md-7 col-xl-8 mr-md-auto">
              <h1>Usage Guide</h1>
              <p>The following describes the features and APIs of Neo4jMapper. It does not describe in detail how to install, 
                configure or use Neo4j. For more inforation about Neo4j, please consult the Neo4j 
                <a href="https://neo4j.com/docs/">documentation</a>.
              </p>
              <p>Neo4jMapper uses <a href="https://github.com/neo4j/neo4j-dotnet-driver">Neo4j Driver</a> for all database 
                connections. Neo4jMapper has a dependency on this driver, and installs the driver when the Neo4jMapper 
                <a href="https://www.nuget.org/packages/Neo4jMapper/">nuget</a> package is added to your project. You should consult 
                the driver <a href="https://neo4j.com/docs/driver-manual/current/">documentation</a> for instructions on how to 
                connect to the database and perform cypher queries.
              </p>
              <h2 id="getting-started">Getting Started</h2>
              <p>Ensure you have a working Neo4j database which can be downloaded from 
                <a href="https://neo4j.com/download/">here</a> and that you can connect to Neo4j's browser console at 
                <a href="http://localhost:7474/browser/">http://localhost:7474/browser/</a>.
              </p>
              <p>Create a new C# project and install Neo4jMapper as detailed <a href="download.html">here</a> and test the database
                connection using the <i>Hello World</i> example described in the Neo4j 
                <a href="https://neo4j.com/docs/driver-manual/current/get-started/">docs</a>.  
              </p>
              <p>Once you've connected to the database and can execute queries in code, you're ready to start writing applications
                using Neo4jMapper.
              </p>
              <h2 id="running-examples">Running Examples</h2>
              <p>The examples given through this guide use the movies database which can be accessed from the Neo4j 
                <a href="http://localhost:7474/browser/">browser</a> console.
              </p>
              <p>From the browser execute the following and step through the pages and run the Create script.</p>
              <pre><code class="language-none">
:play movie-graph
              </code></pre>
              <h2 id="working-with-neo4j-driver">Working with Neo4j Driver output</h2>
              <p><a href="https://github.com/neo4j/neo4j-dotnet-driver">Neo4j Driver</a> allows you to run queries synchronously 
                or asynchronously, both of which provide slightly different APIs due to the way .NET Framwork deals with enumerated 
                results.
              </p>
              <h3>Synchronous Operations</h3>
              <pre><code class="language-csharp">
using (var driver = GraphDatabase.Driver("bolt://localhost:7687"))
{
  using (var session = driver.Session())
  {
    var result = session.Run(@"
      MATCH (person:Person)
      RETURN person
      LIMIT 1");

    foreach (var record in result)
    {
      Console.WriteLine(record.Values.Dump());
    }
  }
}
              </code></pre>
              <p>In this example the <span class="badge badge-secondary">Run</span> method returns an 
                <a href="https://github.com/neo4j/neo4j-dotnet-driver/blob/1.7/Neo4j.Driver/Neo4j.Driver/V1/IStatementResult.cs">IStatementResult</a>
                object which provides us access to the records via the <i>IEnumerable&lt;IRecord&gt;</i>. As we enumerate 
                IStatementResult, each <a href="https://github.com/neo4j/neo4j-dotnet-driver/blob/1.7/Neo4j.Driver/Neo4j.Driver/V1/IRecord.cs">IRecord</a>
                provides us access to the record's query values, in this case, the <i>Person</i> node. The query values are returned 
                as an <i>IDictionary&lt;string, object&gt;</i> via the <span class="badge badge-secondary">Values</span> property.
              </p>
              <p>When we run this example, it outputs the query values to the console using 
                <a href="https://github.com/ServiceStack/ServiceStack.Text">ServiceStack.Text</a> <span class="badge badge-secondary">Dump</span> 
                method, which provides a handy json view of any .NET object or collection.
              </p>
              <pre><code class="language-json">
{
	person: 
	{
		__type: "Neo4j.Driver.Internal.Types.Node, Neo4j.Driver",
		Id: 1,
		Labels: 
		[
			Person
		],
		Properties: 
		[
			{
				Key: name,
				Value: Keanu Reeves
			},
			{
				Key: born,
				Value: 1964
			}
		]
	}
}
              </code></pre>
              <p>We can see that from the dictionary, one key/value pair was returned. The key 'person' matches the identifier name
                used in the query, and value is an object of type 
                <a href="https://github.com/neo4j/neo4j-dotnet-driver/blob/1.7/Neo4j.Driver/Neo4j.Driver/Internal/Types/Node.cs">Node</a>.
                When reading the Node's properties, we can see that it provides another dictionary: 
                <i>IReadOnlyDictionary&lt;string, object&gt;</i> via <span class="badge badge-secondary">Properties</span>. These
                are the actual node's property values. In this example they are returning the 'name' and 'born' values of the actor 
                'Keanu Reeves'.
              </p>
              <h3>Asynchronous Operations</h3>
              <pre><code class="language-csharp">
using (var driver = GraphDatabase.Driver("bolt://localhost:7687"))
{
  using (var session = driver.Session())
  {
    var cursor = await session.RunAsync(@"
      MATCH (movie:Movie)
      RETURN movie
      LIMIT 1");

    foreach (var record in (await cursor.ToListAsync()))
    {
      var output = record.Values.Dump();
      Console.WriteLine(output);
    }
  }
}
              </code></pre>
              <p>In this example the awaitable <span class="badge badge-secondary">RunAsync</span> method returns an 
                <a href="https://github.com/neo4j/neo4j-dotnet-driver/blob/1.7/Neo4j.Driver/Neo4j.Driver/V1/IStatementResultCursor.cs">IStatementResultCursor</a>
                object which provides us access to the records via the awaitable 
                <span class="badge badge-secondary">ToListAsync</span> method, which returns us a <i>List&lt;IRecord&gt;</i>.
              </p>
              <div class="alert alert-info" role="alert">
                <p>You can see that IStatementResultCursor doesn't implement IEnumerable because yielding results from an 
                  enumerator is possible only synchronously in C# 7.
                </p>
              </div>
              <p>As before, when we enumerate the list, each IRecord provides us access to the record's query values, in this case,
                the <i>Movie</i> node. As before, the query values are returned as an <i>IDictionary&lt;string, object&gt;</i> via
                the <span class="badge badge-secondary">Values</span> property.
              </p>
              <pre><code class="language-json">
{
	movie: 
	{
		__type: "Neo4j.Driver.Internal.Types.Node, Neo4j.Driver",
		Id: 0,
		Labels: 
		[
			Movie
		],
		Properties: 
		[
			{
				Key: title,
				Value: The Matrix
			},
			{
				Key: tagline,
				Value: Welcome to the Real World
			},
			{
				Key: released,
				Value: 1999
			}
		]
	}
}                
              </code></pre>
              <p>We can see in the console output that one key/value pair was returned. The key 'movie' matches the identifier name
                used in the query, and value is the Node object and the Properties returns the node's property values. In this
                example they are returning the 'title', 'tagline' and 'released' values of 'The Matrix' movie.
              </p>
              <h2 id="introducing-neo4jmapper">Introducing Neo4jMapper</h2>
              <p>Now you can imagine, having to work directly with IStatementResult, IStatementResultCursor and IRecord would be
                tedious. Trying to extract values from these objects and assigning them to your models would result in a lot of 
                repetitive mapping code.
              </p>
              <p>Neo4jMapper is designed to reduce or eliminate this mapping code. It provides extension methods which takes the 
                IStatementResult and IStatementResultCursor output and turns it into collections of entities. It does this by way 
                of a generic <i>Func</i> delegate which defines the .NET types that the cypher values should be converted to.
              </p>
              <div class="alert alert-info" role="alert">
                <p>We'll use async examples from this point forward as there's no difference in the way Neo4jMapper works whether 
                  you're writing synchronous or asynchronous code.
                </p>
                <p>For brevity, we'll also drop the driver initialization and session creation steps.</p>
              </div>
              <h3 id="map-method">Map&lt;TReturn&gt; method</h3>
              <p>So lets re-visit the first example and use the <span class="badge badge-secondary">Map&lt;TReturn&gt;</span> 
                method to convert the person nodes to <i>Person</i> models.
              </p>
              <pre><code class="language-csharp">
var cursor = await session.RunAsync(@"
  MATCH (person:Person)
  RETURN person
  LIMIT 1");

var person = (await cursor.SingleAsync()).Map&lt;Person&gt;();

var output = person.Dump();
Console.WriteLine(output);
              </code></pre>
              <p>In this example we're using the Neo4j Driver's <span class="badge badge-secondary">SingleAsync</span> extension 
                method as we're expecting only 1 result, so a single <i>IReturn</i> is given. Our 
                <span class="badge badge-secondary">Map&lt;TReturn&gt;</span> method takes <i>IReturn</i> and extracts the cypher
                value from the dictionary and converts it to <i>TReturn</i> type, which in this case is <i>Person</i> type.
              </p>
              <pre><code class="language-json">
{
  name: Keanu Reeves,
  born: 1964
}
              </code></pre>
              <h3 id="return-multiple-values">Returning multiple cypher values</h3>
              <p>This time we wish to query for the actor 'Cuba Gooding Jr.' and the first movie he acted in.</p>
              <pre><code class="language-csharp">
var cursor = await session.RunAsync(@"
  MATCH (actor:Person {name: 'Cuba Gooding Jr.'})-[:ACTED_IN]->(movie:Movie)
  WITH actor, movie
  ORDER BY movie.released
  WITH actor, collect(movie) AS movies
  RETURN actor, head(movies) AS firstMovie");

var actorWithMovie = (await cursor.SingleAsync()).Map((Person actor, Movie firstMovie) => new
{
  Actor = actor,
  FirstMovie = firstMovie
});

var output = actorWithMovie.Dump();
Console.WriteLine(output);
              </code></pre>
              <p>In this example we're using the <span class="badge badge-secondary">Map&lt;TValue1, TValue2, TReturn&gt;</span> 
                method which requries you to declare the two input types we're expecting from the cypher values, and the return type.
               </p>
              <p>The order of <i>TValue1</i> and <i>TValue2</i> is important. It should follow the same order as the cypher <i>RETURN</i>
                statement. So in our example, <i>TValue1</i> is of type <i>Person</i> and <i>TValue2</i> is of type <i>Movie</i>.
                The <i>TReturn</i> type in this example is an anonymous type, and here we just collect the <i>Person</i> and
                <i>Movie</i> values.
              </p>
              <pre><code class="language-json">
{
	Actor: 
	{
		name: Cuba Gooding Jr.,
		born: 1968
	},
	FirstMovie: 
	{
		title: A Few Good Men,
		tagline: "In the heart of the nation's capital, in a courthouse of the U.S. government, one man will stop at nothing to keep his honor, and one will stop at nothing to find the truth.",
		released: 1992
	}
}
              </code></pre>
              <h3 id="returning-lists">Returning lists</h3>
              <p>So far we have been returning only a single record with one or more cypher values, however it is more typical
                to return a list of values and have these converted to a list of .NET types. Neo4jMapper provides 
                <span class="badge badge-secondary">Map</span> methods which work with lists the same as with single records.
              </p>
              <p>This time we wish to query for the 2 oldest actors and for each, return their most recent movie.</p>
              <pre><code class="language-csharp">
var cursor = await session.RunAsync(@"
  MATCH (actor:Person)
  WITH actor
  ORDER BY actor.born
  LIMIT 2
  MATCH (actor)-[:ACTED_IN]->(movie:Movie)
  WITH actor, movie
  ORDER BY movie.released DESC
  WITH actor, collect(movie) AS movies
  RETURN actor, head(movies) AS newestMovie");

var actorWithMovies = (await cursor.ToListAsync()).Map((Person actor, Movie newestMovie) => new
{
  Actor = actor,
  NewestMovie = newestMovie
}).ToList();

var output = actorWithMovies.Dump();
Console.WriteLine(output);
              </code></pre>
              <p>Because we're expecting to receive a list of results, this time we'll use the Neo4j Driver 
                <span class="badge badge-secondary">ToListAsync</span> method to return a list of <I>IRecord</I> objects. To convert these
                to .NET types we'll use the <span class="badge badge-secondary">Map&lt;TValue1, TValue2, TReturn&gt;</span> method which
                takes an <i>IEnumerable&lt;IRecord&gt;</i> and returns an <i>IEnumerable&lt;TReturn&gt;</i>. Again, we'll define an
                anonymous type for <i>TReturn</i> and this time return the converted values as a list.
              </p>
              <pre><code class="language-json">
[
	{
		Actor: 
		{
			name: Gene Hackman,
			born: 1930
		},
		NewestMovie: 
		{
			title: The Replacements,
			tagline: "Pain heals, Chicks dig scars... Glory lasts forever",
			released: 2000
		}
	},
	{
		Actor: 
		{
			name: Max von Sydow,
			born: 1929
		},
		NewestMovie: 
		{
			title: Snow Falling on Cedars,
			tagline: First loves last. Forever.,
			released: 1999
		}
	}
]
              </code></pre>
              <h3 id="supported-types">Supported .NET types</h3>
              <p>Whether working with single records or lists, Neo4jMapper's <span class="badge badge-secondary">Map</span> method allows a
                cypher statement to return up to 16 cypher values or fields. Each cypher value can be one of the supported .NET types
                which includes:
                <ul>
                  <li>CLR data types such as <i>bool</i>, <i>int</i>, <i>string</i></li>
                  <li>Custom types such as <i>Person</i>, <i>Movie</i> etc.</li>
                  <li>Collection types such as <i>IEnumerable&lt;T&gt;</i>, <i>List&lt;T&gt;</i></li>
                </ul>
              </p>
              <p>When specifying the type to use in the <span class="badge badge-secondary">Map</span> method's <i>Func</i> input parameters,
                these must exactly match the expected type to be returned from the cypher values, otherwise an exception is thrown in the mapper.
              </p>
              <p>The next rather contrived example returns some extra cypher values to demonstrate how they should be properly mapped.</p>
              <p>First we've created a projection object to hold all our cypher values.</p>
              <pre><code class="language-csharp">
class Example6Projection
{
  public int NumberOfMovies { get; set; }
  public string ActorName { get; set; }
  public Person Actor { get; set; }
  public bool HasMovies { get; set; }
  public List&lt;Movie&gt; Movies { get; set; }
}
              </code></pre>
              <p>Now we'll construct a cypher query to return some additional data.</p>
              <pre><code class="language-csharp">
var cursor = await session.RunAsync(@"
  MATCH (actor:Person {name: 'Cuba Gooding Jr.'})-[:ACTED_IN]->(movie:Movie)
  WITH count(movie) as countOfMovies, actor.name as actorName, actor, COLLECT(movie) as movies
  RETURN countOfMovies, actorName, actor, size(movies) > 0 as hasMovies, movies");

var actorWithMovies = (await cursor.SingleAsync())
  .Map&lt;int, string, Person, bool, List&lt;Movie&gt;, Example6Projection&gt;(
    (numOfMovies, actorName, person, hasMovies, movies) => new Example6Projection
    {
      NumberOfMovies = numOfMovies,
      ActorName = actorName,
      Actor = person,
      HasMovies = hasMovies,
      Movies = movies
    });

var output = actorWithMovies.Dump();
Console.WriteLine(output);
              </code></pre>
              <p>As we can see, the <i>Func</i> input parameters exactly match, and are in the same order as the <i>RETURN</i> statement
                cypher value list.
              </p>
              <pre><code class="language-json">
{
	NumberOfMovies: 4,
	ActorName: Cuba Gooding Jr.,
	Actor: 
	{
		name: Cuba Gooding Jr.,
		born: 1968
	},
	HasMovies: True,
	Movies: 
	[
		{
			title: What Dreams May Come,
			tagline: After life there is more. The end is just the beginning.,
			released: 1998
		},
		{
			title: Jerry Maguire,
			tagline: The rest of his life begins now.,
			released: 2000
		},
		{
			title: As Good as It Gets,
			tagline: A comedy from the heart that goes for the throat.,
			released: 1997
		},
		{
			title: A Few Good Men,
			tagline: "In the heart of the nation's capital, in a courthouse of the U.S. government, one man will stop at nothing to keep his honor, and one will stop at nothing to find the truth.",
			released: 1992
		}
	]
}
              </code></pre>
              <hr>
              <p class="lead">This software is developed and maintained by the Barnardos Australia software development <a href="https://github.com/barnardos-au">team</a>,
                as a voluntary effort. If you find this software
                useful, please consider making a donation to Barnardos Australia using the links below.<br> Thank you.
              </p>
            </div>

            <!-- Sidebar -->
            <div class="col-md-4 col-xl-3 d-none d-md-block">
              <aside class="sidebar sidebar-sticky stick" style="width: 255px;">
                <h6 class="sidebar-title">Contents</h6>
                <nav id="nav-scrollspy" class="nav flex-column">
                  <a class="nav-link" href="#getting-started">Getting Started</a>
                  <a class="nav-link" href="#running-examples">Running Examples</a>
                  <a class="nav-link" href="#working-with-neo4j-driver">Working with Neo4j Driver output</a>
                  <a class="nav-link" href="#introducing-neo4jmapper">Introducing Neo4jMapper</a>
                  <a class="nav-link nav-link-child" href="#map-method">Map&lt;TReturn&gt; method</a>
                  <a class="nav-link nav-link-child" href="#return-multiple-values">Returning multiple cypher values</a>
                  <a class="nav-link nav-link-child" href="#returning-lists">Returning lists</a>
                  <a class="nav-link nav-link-child" href="#supported-types">Supported .NET types</a>
                </nav>
              </aside>
            </div>

          </div>
          <div id="barnardos-donate" class="row">
            <div class="col-lg-8 mx-auto">
              <a href="https://www.barnardos.org.au">
                <img src="assets/img/barnardos-australia.png" alt="Barnardos Australia" class="barnardos-logo float-left">
              </a>
              <h6 class="barnardos-we-believe float-left mr-8">We believe in children.</h6>
              <a class="btn btn-success btn-lg btn-barnardos btn-barnardos-donate mt-2" href="https://donate.barnardos.org.au/donate-now/donate/">Donate Now</a>
            </div>
          </div>
        </div>
      </section>

    </main>


    <!-- Footer -->
    <footer class="footer">
      <div class="container">
        <div class="row gap-y align-items-center">

          <div class="col-6 col-lg-3">
            <a href="index.html"><img src="assets/img/neo4j-mapper-logo-dark.png" alt="logo"></a>
          </div>

          <div class="col-6 col-lg-3 text-right order-lg-last">
            <div class="social barnardos-social-media-icons">
              <a class="social-github" href="https://www.linkedin.com/company/barnardos-australia"><i class="fa fa-linkedin"></i></a>
              <a class="social-twitter" href="https://twitter.com/barnardos_aus"><i class="fa fa-twitter"></i></a>
              <a class="social-twitter" href="https://www.facebook.com/BarnardosAustralia"><i class="fa fa-facebook"></i></a>
              <a class="social-twitter" href="https://instagram.com/barnardos_au/"><i class="fa fa-instagram"></i></a>
              <a class="social-twitter" href="https://www.youtube.com/user/barnardosaustralia/featured"><i class="fa fa-youtube"></i></a>
            </div>
          </div>

          <div class="col-lg-6">
            <div class="nav nav-bold nav-uppercase nav-trim justify-content-lg-center">
              <a class="nav-link" href="about.html">About</a>
            </div>
          </div>

        </div>
      </div>
    </footer><!-- /.footer -->


    <!-- Scripts -->
    <script src="assets/js/page.min.js"></script>
    <script src="assets/js/prism.js"></script>

  </body>
</html>
